[#import "/framework/JGP.htm"  as JGP]
<!--
项目   ljoa
作者  SSF
时间   2019/1/5
-->
[@JGP.head "$Title$"/]
[@JGP.body]
<jgp-div _row="['*','45']" _runit="px">

    <jgp-panel slot="1-1" >
        <jgp-form _label_width="120px" _id="form" _method="post" _fdata='${fdata!''}' _action="/ljoa/channel/ljHouseSaleInfoApiController/saveLjHouseSaleInfo">
            <jgp-form-group _title="客户信息" _col="12" _label_width="130px">
                <jgp-text _name="houseUuid" _label="房源主键：" style="display: none"   _col="6"></jgp-text>
                <jgp-text _name="customerName" _label="客户姓名：" _required="true" _col="6"></jgp-text>
                <jgp-text _name="customerTel" _label="客户电话：" _required="true" _col="6"></jgp-text>
                <jgp-text _name="identityCode" _label="客户身份证号："  _col="6"></jgp-text>
                <jgp-num _name="totalPrice" _id="totalPrice" _onchange="changeTotalPrice" _label="成交总价：" _required="true"  _decimal="5"  _col="6"></jgp-num>
                <jgp-date-time _not_input="true" _name="buyTime" _label="认购日期：" _required="true" _format="date"></jgp-date-time>
                <jgp-date-time _not_input="true" _name="signTime" _label="签约日期："  _format="date"></jgp-date-time>
                <jgp-drop _not_input="true" _name="payType" _label="付款方式：" _required="true" _active_key="LJOA.CHANNEL.PAY_TYPE"  _col="6"></jgp-drop>
            </jgp-form-group>
            <jgp-form-group  _title="公司业绩" _col="12" _label_width="160px">
                <jgp-num _name="companyTax" _label="公司业绩(元)："  _decimal="5"  _col="6" _readonly="true"></jgp-num>
                <jgp-drop _not_input="true" _name="companyTaxDeduction" _id="companyTaxDeduction" _onchange="editCaseManagerChargeType"  _label="公司业绩扣税方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE"  _col="6"></jgp-drop>
                <jgp-drop _not_input="true"  _name="companyTaxDeductionScale" _id="companyTaxDeductionScale" _label="公司业绩扣税比例(%)：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"   _col="6"></jgp-drop>
                <jgp-num _name="companyTaxDeductionMoney" _id="companyTaxDeductionMoney" _label="公司业绩扣税金额(元):" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="companyTaxDeductionAfterMoney" _id="companyTaxDeductionAfterMoney" _label="公司业绩税后金额(元):" _readonly="true" _decimal="5"  _col="6"></jgp-num>
            </jgp-form-group>
            <jgp-form-group _title="第三方渠道" _col="12" _label_width="150px">
                <jgp-drop _not_input="true" _name="channelCompany" _label="渠道公司：" _url="/ljoa/channel/LjChannelCompanyApiController/listAllLjChannelCompany"  _col="6"></jgp-drop>
                <jgp-drop _not_input="true" _name="channelChargeType" _id="channeChargeType" _onchange="editChargeType" _label="渠道佣金方式："   _active_key="LJOA.CHANNEL.CHARGE_TYPE"   _col="6"></jgp-drop>
                <jgp-num _name="channelChargeMoney" _id="channeChargeMoney" _label="渠道佣金金额(元)：" _readonly="true"  _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="channelChargeScale" _id="channeChargeScale" _label="渠道佣金比例(%)：" _readonly="true"  _decimal="5" _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="channelTaxType" _id="channelTaxType" _label="渠道佣金缴税方式：" _onchange="editChannelTaxScale"  _active_key="LJOA.CHANNEL.TAX_TYPE"  _col="6"></jgp-drop>
                <jgp-num  _name="channelTaxScale"  _id="channelTaxScale" _label="渠道扣税比例(%)：" _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="channelTaxMoney" _id="channelTaxMoney" _label="渠道扣税金额(元)：" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="channelAfterTaxMoney" _id="channelAfterTaxMoney" _label="渠道税后佣金(元)：" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-drop _name="channelChargeStatus" _label="渠道佣金状态："  _readonly="true" _active_key="LJOA.MAIDSTATUS"  _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="channelChargeSendDate" _label="渠道结佣时间：" _readonly="true" _format="date" _col="6"></jgp-date-time>
                <jgp-text _name="dutyMan" _label="个人：" _col="6"></jgp-text>
                <jgp-num _name="dutyManMoney" _label="个人奖(元)："  _decimal="5"  _col="6"></jgp-num>
            </jgp-form-group>
        [#--        <jgp-form-group _title="渠道员工" _col="12" _label_width="150px">
                    <jgp-drop _name="adviser" _label="员工姓名：" _required="true"  _url="/ljoa/hr/employeeApiController/listAllEmployee" _col="6"></jgp-drop>
                    <jgp-num _name="adviserMonty" _label="提成(元)：" _required="true" _decimal="5"  _col="6"></jgp-num>
         </jgp-form-group>--]
  [#--          <jgp-form-group _title="案场经理佣金" _col="12" _label_width="165px">
                <jgp-drop _name="caseManager" _label="案场经理："  _url="/ljoa/hr/employeeApiController/listAllEmployee" _required="true" _col="6"></jgp-drop>
                <jgp-drop _not_input="true" _name="caseManagerChargeType" _id="caseManagerChargeType" _onchange="editManagerChargeType" _label="案场经理提成方式：" _required="true" _active_key="LJOA.CHANNEL.CHARGE_TYPE"  _col="6"></jgp-drop>
                <jgp-drop _not_input="true"  _name="caseManagerChargeScale" _id="caseManagerChargeScale" _label="案场经理提成比例(%)：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"   _col="6"></jgp-drop>
                <jgp-num _name="caseManagerChargeMoney" _id="caseManagerChargeMoney" _label="案场经理提成金额(元):" _readonly="true" _decimal="5"  _col="6"></jgp-num>
            </jgp-form-group>--]
        [#--        <jgp-form-group _title="渠道" _col="12" _label_width="165px">
                    <jgp-drop _name="channelManager" _label="渠道经理："  _url="/ljoa/hr/employeeApiController/listAllEmployee"  _required="true" _col="6"></jgp-drop>
                    <jgp-drop _not_input="true" _name="channelManagerChargeType" _id="channelManagerChargeType" _onchange="editchannelManagerChargeType"   _label="渠道经理提成方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE"   _col="6"></jgp-drop>
                    <jgp-drop _not_input="true"   _name="channelManagerChargeScale" _id="channelManagerChargeScale" _label="渠道经理提成比例(%)："  _active_key="LJOA.CHANNEL.SCALE"  _col="6"></jgp-drop>
                    <jgp-num _name="channelManagerChargeMoney" _id="channelManagerChargeMoney" _label="渠道经理提成金额(元)：" _label_width="180px"  _decimal="5"  _col="6"></jgp-num>
        --][#--            <jgp-text _name="channelChief" _label="渠道总监：" _required="true" _col="6"></jgp-text>
            <jgp-drop _not_input="true" _name="channelChiefChargeType" _id="channelChiefChargeType" _onchange="editchannelChiefChargeType" _label="渠道总监提成方式：" _required="true" _active_key="LJOA.CHANNEL.CHARGE_TYPE"  _col="6"></jgp-drop>
            <jgp-drop _not_input="true" _name="channelChiefChargeScale" _id="channelChiefChargeScale" _label="渠道总监提成比例：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"   _col="6"></jgp-drop>
            <jgp-num _name="channelChiefChargeMoney" _id="channelChiefChargeMoney" _label="渠道总监提成金额：" _readonly="true"  _decimal="5"  _col="6"></jgp-num>--][#--
        </jgp-form-group>--]
            <jgp-form-group  _title="公司利润" _col="12" _label_width="150px">
                <jgp-num _name="companyProfit" _label="公司利润(元)：" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="insideChargeStatus" _label="内部佣金状态："  _readonly="true" _active_key="LJOA.MAIDSTATUS" _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="insideChargeSendDate" _label="内部结佣时间：" _readonly="true" _format="date" _col="6"></jgp-date-time>
                <jgp-drop _not_input="true" _name="chargeStatus" _label="佣金状态：" _readonly="true"  _active_key="LJOA.CHANNEL.CHARGE_STATUS"  _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="chargeSendDate" _label="结佣时间：" _readonly="true"  _format="date"></jgp-date-time>
            </jgp-form-group>

        </jgp-form>
    </jgp-panel>
    <div slot="2-1" style="margin-left: 65%">
        [#--<jgp-btn _icon="edit" _fn="editStatus" _type="normal" >提交审批</jgp-btn>--]
        <jgp-btn _icon="floppy-o" _form="form" _fn="saveCallBack">保存</jgp-btn>
    </div>
</jgp-div>
[/@JGP.body]

[@JGP.foot]
<script>
    var ChargeStatus="${ChargeStatus!''}";


    JGP.$onload(function () {
        if(ChargeStatus == '1'||ChargeStatus == '2'||ChargeStatus == '4'||ChargeStatus == '6'|| ChargeStatus =='8'|| ChargeStatus=='10'){
            JGP.form('form').attr('_disabled','true');
        }
        if(ChargeStatus=='3'){
            JGP.$warn("该信息部门审核不通过请修改！");
            return;
        }
        if(ChargeStatus=='5'){
            JGP.$warn("该信息财务审核不通过请修改！");
            return;
        }
        if(ChargeStatus=='7'){
            JGP.$warn("该信息副总审核不通过请修改！");
            return;
        }
        if(ChargeStatus=='9'){
            JGP.$warn("该信息总经理审核不通过请修改！");
            return;
        }



    })
    /*    //输入成交总价
        function changeTotalPrice() {
           var money= JGP.num("totalPrice").val();
            if(companyChargeScale != 0){
                realMoney = money * companyChargeScale;
            }
        }*/

    function saveCallBack(result) {
        if(ChargeStatus == '1'||ChargeStatus == '2'||ChargeStatus == '4'||ChargeStatus == '6'|| ChargeStatus =='8'|| ChargeStatus=='10'){
            JGP.$warn("该信息已上报不可修改！");
            return;
        }
        if(result.back && result.back.flag){
            JGP.$alert("添加成功！");
            JGP.$close(true);
        }else {
            JGP.$warn("添加失败！");
            JGP.$close(false);
        }
    }

    function editStatus(re) {
        var id = JGP.form('form').field('id');
        var chargeStatus=JGP.form('form').field('chargeStatus');
//        console.log(id);
        if (id == undefined) {
            JGP.$warn("该房源销售信息尚未保存,请先保存！！");
            return;
        }
        if(ChargeStatus == '1'||ChargeStatus == '2'||ChargeStatus == '4'||ChargeStatus == '6'|| ChargeStatus =='8'|| ChargeStatus=='10'){
            JGP.$warn("该房源销售信息已在审核流程中！");
            return;
        }
        JGP.$confirm("是否提交到渠道总监？", function () {
            JGP.$post("/ljoa/channel/ljHouseSaleInfoApiController/editljHouseSaleInfoChargeStatus/"+id,{},
                    function (re) {
                        if(re.flag){
                            JGP.$alert("提交成功！");
                            window.location.reload();
                        }else{
                            JGP.$error("提交失败！");
                            window.location.reload();
                        }
                    },function () {

                    })
        })
    }

    //渠道佣金方式转化
    function editChargeType() {
        var type=JGP.drop("channeChargeType").val();
        if(type=="1"){//比例
            JGP.num("channeChargeScale").attr("_required","true");
            JGP.num("channeChargeScale").attr("_readonly","false");
            JGP.num("channeChargeMoney").attr("_readonly","true");
            JGP.num("channeChargeMoney").attr("_required","false");
            JGP.num("channeChargeMoney").val(0);

        }
        if(type=="2"){
            JGP.num("channeChargeScale").attr("_readonly","true");
            JGP.num("channeChargeScale").attr("_required","false");
            JGP.num("channeChargeScale").val(0);
            JGP.num("channeChargeMoney").attr("_required","true");
            JGP.num("channeChargeMoney").attr("_readonly","false");
        }
    }
    //案场经理提成方式转化
    function editManagerChargeType() {
        var type=JGP.drop("caseManagerChargeType").val();
        if(type=="1"){//比例
            JGP.drop("caseManagerChargeScale").attr("_required","true");
            JGP.drop("caseManagerChargeScale").attr("_readonly","false");
            JGP.num("caseManagerChargeMoney").attr("_readonly","true");
            JGP.num("caseManagerChargeMoney").attr("_required","false");
            JGP.num("caseManagerChargeMoney").val(0);
        }
        if(type=="2"){
            JGP.num("caseManagerChargeMoney").attr("_readonly","false");
            JGP.num("caseManagerChargeMoney").attr("_required","true");
            JGP.drop("caseManagerChargeScale").val(0);
            JGP.drop("caseManagerChargeScale").attr("_required","flase");
            JGP.drop("caseManagerChargeScale").attr("_readonly","true");
        }
    }
    //渠道经理提成方式转化
    function editchannelManagerChargeType() {
        var type=JGP.drop("channelManagerChargeType").val();
        if(type=="1"){//比例
            JGP.drop("channelManagerChargeScale").attr("_required","true");
            JGP.drop("channelManagerChargeScale").attr("_readonly","false");
            JGP.num("channelManagerChargeMoney").attr("_readonly","true");
            JGP.num("channelManagerChargeMoney").attr("_required","false");
            JGP.num("channelManagerChargeMoney").val(0);
        }
        if(type=="2"){
            JGP.num("channelManagerChargeMoney").attr("_readonly","false");
            JGP.num("channelManagerChargeMoney").attr("_required","true");
            JGP.drop("channelManagerChargeScale").attr("_required","flase");
            JGP.drop("channelManagerChargeScale").attr("_readonly","true");
            JGP.drop("channelManagerChargeScale").val(0);
        }
    }
    //渠道总监提成方式转化
    function editchannelChiefChargeType() {
        var type=JGP.drop("channelChiefChargeType").val();
        if(type=="1"){//比例
            JGP.drop("channelChiefChargeScale").attr("_required","true");
            JGP.drop("channelChiefChargeScale").attr("_readonly","false");
            JGP.num("channelChiefChargeMoney").attr("_readonly","true");
            JGP.num("channelChiefChargeMoney").attr("_required","false");
            JGP.num("channelChiefChargeMoney").val(0);
        }
        if(type=="2"){
            JGP.num("channelChiefChargeMoney").attr("_readonly","false");
            JGP.num("channelChiefChargeMoney").attr("_required","true");
            JGP.drop("channelChiefChargeScale").attr("_required","flase");
            JGP.drop("channelChiefChargeScale").attr("_readonly","true");
            JGP.drop("channelChiefChargeScale").val(0);

        }
    }
    //公司业绩
    function editCaseManagerChargeType() {
        var type=JGP.drop("companyTaxDeduction").val();
        if(type=="1"){//比例
            JGP.drop("companyTaxDeductionScale").attr("_required","true");
            JGP.drop("companyTaxDeductionScale").attr("_readonly","false");
            JGP.num("companyTaxDeductionMoney").attr("_readonly","true");
            JGP.num("companyTaxDeductionMoney").attr("_required","false");
            JGP.num("companyTaxDeductionMoney").val(0);
        }
        if(type=="2"){
            JGP.num("companyTaxDeductionMoney").attr("_readonly","false");
            JGP.num("companyTaxDeductionMoney").attr("_required","true");
            JGP.drop("companyTaxDeductionScale").attr("_required","flase");
            JGP.drop("companyTaxDeductionScale").attr("_readonly","true");
//            JGP.drop("companyTaxDeductionScale").val(0);
        }
    }

    //缴税的
    function editChannelTaxScale() {
        var type=JGP.drop("channelTaxType").val();
        if(type=="2"){//代缴
            JGP.num("channelTaxScale").attr("_required","true");
            JGP.num("channelTaxScale").attr("_readonly","false");
            JGP.num("channelTaxMoney").val(0);
            JGP.num("channelAfterTaxMoney").val(0);
        }
        if(type=="1"){//自交
//            JGP.num("channelAfterTaxMoney").attr("_required","true");
//            JGP.num("channelAfterTaxMoney").attr("_readonly","false");
            JGP.num("channelTaxScale").attr("_required","flase");
            JGP.num("channelTaxScale").attr("_readonly","true");
            JGP.drop("channelTaxScale").val(0);
            JGP.num("channelTaxMoney").val(0);
        }
    }

</script>
[/@JGP.foot]