[#import "/framework/JGP.htm"  as JGP]
<!--
项目   ljoa
作者  SSF
时间   2018/7/5
-->
[@JGP.head "$Title$"/]
[@JGP.body]
<jgp-div _row="['160','*','45']" _runit="px">
    <jgp-form slot="1-1" _id="formLjApproval" _label_width="130px" _action="/ljoa/com/approvalApiController/saveLjApproval" _fdata='${fdata!''}' _method="post" >
        [#--<jgp-text _name="checkMan" _label="审批人：" _required="true"></jgp-text>--]
        <jgp-drop _readonly="true" _active_key="LJOA.TONG.CHECK_CONTENT" _name="checkContent" _label="审批业务："></jgp-drop>
        <jgp-drop _readonly="true" _active_key="LJOA.TONG.CHECK_TYPE" _name="checkType" _label="审批类别："></jgp-drop>
        <jgp-radio _id="checkResult"  _name="checkResult" _active_key="LJOA.TONG.CHECK_RESULT" _onchange="editStatus" _label="审批结果：" _required="true" _not_input="true"></jgp-radio>
        <jgp-date-time _format="date" _name="checkTime" _label="审批时间：" _readonly="true" ></jgp-date-time>

        <jgp-area _name="checkOption" _label="审批意见：" _col="12"  _required="true"></jgp-area>
    </jgp-form>
    <jgp-panel slot="2-1" _title="房源销售信息" _default_tools="[]">
        <jgp-form _label_width="120px" _id="form" _method="post" _fdata='${channelHouseSaleInfo!''}' _action="/ljoa/channel/ljHouseSaleInfoApiController/saveLjHouseSaleInfo">
            <jgp-form-group _title="客户信息" _col="12" _label_width="130px">
                [#--<jgp-text _name="dutyManUuid" _label="负责人：" _readonly="true" _col="6"></jgp-text>--]
                <jgp-num _name="totalPrice" _label="成交总价(元)：" _readonly="true" _decimal="5" _col="6"></jgp-num>
                <jgp-date-time _name="buyTime" _label="认购日期：" _readonly="true" _format="date"></jgp-date-time>
                <jgp-date-time _name="signTime" _label="签约日期：" _readonly="true" _format="date"></jgp-date-time>
                <jgp-drop _name="payType" _label="付款方式：" _readonly="true" _active_key="LJOA.CHANNEL.PAY_TYPE" _col="6"></jgp-drop>
            </jgp-form-group>
            <jgp-form-group  _title="公司业绩" _col="12" _label_width="160px">
                <jgp-num _name="companyTax" _label="公司业绩(元)："  _decimal="5"  _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="companyTaxDeduction" _id="companyTaxDeduction" _onchange="editCaseManagerChargeType"  _label="公司业绩扣税方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE"  _col="6"></jgp-drop>
                <jgp-drop _not_input="true"  _name="companyTaxDeductionScale" _id="companyTaxDeductionScale" _label="公司业绩扣税比例(%)：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"   _col="6"></jgp-drop>
                <jgp-num _name="companyTaxDeductionMoney" _id="companyTaxDeductionMoney" _label="公司业绩扣税金额(元):" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="companyTaxDeductionAfterMoney" _id="companyTaxDeductionAfterMoney" _label="公司业绩税后金额(元):" _readonly="true" _decimal="5"  _col="6"></jgp-num>
            </jgp-form-group>
            <jgp-form-group _title="渠道公司" _col="12" _label_width="165px">
                <jgp-drop _not_input="true" _name="channelCompany" _label="渠道公司：" _url="/ljoa/channel/LjChannelCompanyApiController/listAllLjChannelCompany" _readonly="true" _col="6"></jgp-drop>
                <jgp-drop _not_input="true"  _name="channelChargeType" _label="渠道佣金方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE" _readonly="true" _col="6"></jgp-drop>
                <jgp-num _name="channelChargeMoney" _label="渠道佣金金额(元)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
                <jgp-num _name="channelChargeScale" _label="渠道佣金比例(%)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="channelTaxType" _label="渠道佣金缴税方式：" _active_key="LJOA.CHANNEL.TAX_TYPE" _readonly="true" _col="6"></jgp-drop>
                [#--<jgp-num _name="channelTaxScale" _label="渠道扣税比例(%)：" _decimal="5" _readonly="true" _col="6"></jgp-num>--]
                <jgp-num  _name="channelTaxScale"  _id="channelTaxScale" _label="渠道扣税比例(%)：" _decimal="5"  _col="6"></jgp-num>
                <jgp-num _name="channelTaxMoney" _label="渠道扣税金额(元)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
                <jgp-num _name="channelAfterTaxMoney" _label="渠道公司税后佣金(元)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="channelChargeStatus" _label="渠道佣金状态："  _readonly="true" _active_key="LJOA.MAIDSTATUS"  _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="channelChargeSendDate" _label="渠道结佣时间：" _readonly="true" _format="date" _col="6"></jgp-date-time>
                <jgp-text _name="dutyMan" _label="个人：" _readonly="true" _col="6"></jgp-text>
                <jgp-num _name="dutyManMoney" _label="个人奖(元)：" _decimal="5"  _readonly="true" _col="6"></jgp-num>
            </jgp-form-group>
[#--
            <jgp-form-group _title="渠道员工" _col="12" _label_width="130px">
                <jgp-drop _name="adviser" _label="员工姓名："  _url="/ljoa/hr/employeeApiController/listAllEmployee" _readonly="true" _col="6"></jgp-drop>
                <jgp-num _name="adviserMonty" _label="提成(元)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
            </jgp-form-group>--]

            <jgp-form-group _title="案场经理佣金" _col="12" _label_width="165px">
                <jgp-drop _name="caseManager" _label="案场经理："  _url="/ljoa/hr/employeeApiController/listAllEmployee"  _required="true" _readonly="true" _col="6"></jgp-drop>
                <jgp-drop _name="caseManagerChargeType" _label="案场经理提成方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE" _readonly="true" _col="6"></jgp-drop>
                <jgp-num _name="caseManagerChargeScale" _label="案场经理提成比例(%)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
                <jgp-num _name="caseManagerChargeMoney" _label="案场经理提成金额(元)：" _decimal="5" _readonly="true" _col="6"></jgp-num>
            [#--<jgp-drop _name="caseManagerChargeStatus" _label="案场经理佣金状态：" _active_key="LJOA.CHANNEL.CHARGE_STATUS" _readonly="true" _col="6"></jgp-drop>--]
            </jgp-form-group>
            <jgp-form-group _title="区域经理佣金" _col="12" _label_width="165px">
                <jgp-drop _name="areaManage" _label="区域经理：" _url="/ljoa/hr/employeeApiController/listAllEmployee" _required="true" _col="6"></jgp-drop>
                <jgp-drop _not_input="true" _name="areaManagerChargeType" _id="areaManagerChargeType" _onchange="editChannelManagerChargeType"  _required="true" _label="区域经理提成方式：" _active_key="LJOA.CHANNEL.CHARGE_TYPE"   _col="6"></jgp-drop>
                <jgp-drop _not_input="true" _name="areaManagerChargeScale" _id="areaManagerChargeScale" _label="区域经理提成比例(%)：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"  _col="6"></jgp-drop>
                <jgp-num _name="areaManagerChargeMoney" _id="areaManagerChargeMoney" _label="区域经理提成金额(元)：" _readonly="true" _decimal="5"  _col="6"></jgp-num>
            </jgp-form-group>
                <jgp-form-group _title="渠道总监佣金" _col="12" _label_width="165px">
                    <jgp-drop _name="channelChief" _label="渠道总监：" _url="/ljoa/hr/employeeApiController/listAllEmployee" _required="true" _col="6"></jgp-drop>
                    <jgp-drop _not_input="true" _name="channelChiefChargeType" _id="channelChiefChargeType" _onchange="editchannelChiefChargeType" _label="渠道总监提成方式：" _required="true" _active_key="LJOA.CHANNEL.CHARGE_TYPE"  _col="6"></jgp-drop>
                    <jgp-drop _not_input="true" _name="channelChiefChargeScale" _id="channelChiefChargeScale" _label="渠道总监提成比例(%)：" _readonly="true" _active_key="LJOA.CHANNEL.SCALE"   _col="6"></jgp-drop>
                    <jgp-num _name="channelChiefChargeMoney" _id="channelChiefChargeMoney" _label="渠道总监提成金额(元)：" _readonly="true"  _decimal="5"  _col="6"></jgp-num>
                </jgp-form-group>
            <jgp-form-group  _title="公司利润" _col="12" _label_width="150px">
                <jgp-num _name="companyProfit" _label="公司利润(元)：" _readonly="true" _decimal="5"  _col="6"></jgp-num>
                <jgp-drop _not_input="true" _name="insideChargeStatus" _label="内部佣金状态："  _readonly="true" _active_key="LJOA.MAIDSTATUS" _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="insideChargeSendDate" _label="内部结佣时间：" _readonly="true" _format="date" _col="6"></jgp-date-time>
                <jgp-drop _not_input="true" _name="chargeStatus" _id="chargeStatus" _label="佣金状态：" _readonly="true"  _active_key="LJOA.CHANNEL.CHARGE_STATUS"  _col="6"></jgp-drop>
                <jgp-date-time _not_input="true" _name="chargeSendDate" _label="结佣时间：" _readonly="true"  _format="date"></jgp-date-time>
                <jgp-uploader _allow="all" _object_id='${uuid!''}' _object_type="com.jgp.ljoa.channel.model.LjHouseSaleInfo"></jgp-uploader>
            </jgp-form-group>
        </jgp-form>
    </jgp-panel>
    <div slot="3-1" style="margin-left: 75%">
        <jgp-btn  _fn="ljApprovalSaveCallBack" _icon="check">完成审批</jgp-btn>
    </div>
    </jgp-div>
[/@JGP.body]

[@JGP.foot]
<script>

    var chargeStatus = '${chargeStatus!''}';

    JGP.$onload(function () {
        //JGP.drop("chargeStatus").val("8");
        if(chargeStatus != '4'){
            JGP.form('form').attr('_disabled','true');
            JGP.form('formLjApproval').attr('_disabled','true');
            JGP.$warn('此信息已审批！');
        }
    })

    function ljApprovalSaveCallBack() {
        var checkResult = JGP.form('formLjApproval').field('checkResult');
        if(checkResult == '' || checkResult == undefined){
            JGP.$alert('请填写审批结果！');
            return;
        }
        JGP.form("form").ajaxSubmit(function (re) {
            JGP.form("formLjApproval").ajaxSubmit(function () {
                JGP.$alert("审批成功！");
                JGP.$close(true);
            },function () {
                JGP.$error("审批失败！");
                JGP.$close(false);
            })
        },function (re) {
            JGP.$error("审批失败！");
            JGP.$close(false);
        })
    }

    //审批通过后修改报销状态
    function editStatus() {
        if(JGP.radio('checkResult').val()=='Y'){
            JGP.drop("chargeStatus").val("8");
        }else if(JGP.radio('checkResult').val()=='N'){
            JGP.drop("chargeStatus").val("9");
        }
    }

</script>
[/@JGP.foot]